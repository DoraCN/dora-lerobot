# æœºå™¨äººæ¨¡ä»¿å­¦ä¹ æ¯”èµ›æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸¦æ‚¨å®Œæˆå®Œæ•´çš„æœºå™¨äººæ¨¡ä»¿å­¦ä¹ æµç¨‹ï¼šä»æ•°æ®é‡‡é›†ã€æ¨¡å‹è®­ç»ƒåˆ°ç­–ç•¥æ¨ç†ã€‚æœ¬æŒ‡å—åŸºäºLeRobotæ¡†æ¶ï¼Œä½¿ç”¨ä»¿çœŸç¯å¢ƒè¿›è¡Œæœºå™¨äººæŠ“å–ä»»åŠ¡çš„æ¨¡ä»¿å­¦ä¹ ã€‚

## ç¯å¢ƒå‡†å¤‡

### 1. ç³»ç»Ÿè¦æ±‚
- Ubuntu 20.04+ æˆ–ç±»ä¼¼Linuxå‘è¡Œç‰ˆ
- Python 3.10
- CUDAæ”¯æŒçš„GPUï¼ˆæ¨èï¼‰
- è‡³å°‘8GBå†…å­˜

### 2. å®‰è£…Miniconda
```bash
# ä¸‹è½½å¹¶å®‰è£…Miniconda
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
```

### 3. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
# åˆ›å»ºPython 3.10ç¯å¢ƒ
conda create -y -n lerobot_v3 python=3.10

# æ¿€æ´»ç¯å¢ƒ
conda activate lerobot_v3

# å®‰è£…ffmpeg
conda install ffmpeg -c conda-forge
```

### 4. å®‰è£…LeRobot
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/huggingface/lerobot.git
cd lerobot

# å®‰è£…ä¾èµ–
pip install -e .
```

## å®Œæ•´å·¥ä½œæµç¨‹

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®é‡‡é›†

#### 1. åˆ›å»ºæ•°æ®é‡‡é›†é…ç½®
åˆ›å»ºæ–‡ä»¶ `env_config_gym_hil_il.json`ï¼š

```json
{
  "env": {
    "name": "gym_hil",
    "task": "PandaPickCubeKeyboard-v0",
    "fps": 8,
    "processor": {
      "reset": {
        "control_time_s": 20.0,
        "fixed_reset_joint_positions": [0.0, 0.195, 0.0, -2.43, 0.0, 2.62, 0.785],
        "reset_time_s": 2.0,
        "terminate_on_success": true
      }
    }
  },
  "dataset": {
    "repo_id": "jzzz/il_gym1",
    "task": "pick_cube",
    "num_episodes_to_record": 5,
    "replay_episode": null,
    "push_to_hub": false
  },
  "mode": "record",
  "device": "cuda"
}
```
å…¶ä¸­ä¿®æ”¹ "repo_id": "jzzz/il_gym",ä¸ºæ‚¨æœ¬åœ°çš„è·¯å¾„ï¼Œé€šå¸¸æœ¬åœ°ä¼šå­˜å‚¨åœ¨/home/jzzz/.cache/huggingface/lerobot/jzzz/il_gymä¸‹ã€‚

#### 2. å¼€å§‹æ•°æ®é‡‡é›†
```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate lerobot_v3

# è¿è¡Œæ•°æ®é‡‡é›†
python -m lerobot.rl.gym_manipulator --config_path env_config_gym_hil_il.json 
```

**é”®ç›˜æ§åˆ¶è¯´æ˜ï¼š**
Keyboard controls:
  - Arrow keys: Move in X-Y plane
  - Shift and Shift_R: Move in Z axis
  - Right Ctrl and Left Ctrl: Open and close gripper
  - Enter: End episode with SUCCESS
  - Backspace: End episode with FAILURE
  - Space: Start/Stop Intervention
  - ESC: Exit

**é‡‡é›†å»ºè®®ï¼š**
- è‡³å°‘é‡‡é›†5ä¸ªå®Œæ•´çš„episode
- æ¯ä¸ªepisodeåŒ…å«å®Œæ•´çš„æŠ“å–-æ”¾ç½®ä»»åŠ¡
- ä¿æŒåŠ¨ä½œæµç•…ï¼Œé¿å…çªç„¶çš„æ€¥åœ
- ç¡®ä¿ä»»åŠ¡æˆåŠŸå®Œæˆï¼ˆç»¿è‰²æç¤ºï¼‰

### ç¬¬äºŒé˜¶æ®µï¼šæ¨¡å‹è®­ç»ƒ

#### 1. è®­ç»ƒACTç­–ç•¥
```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate lerobot_v3

# å¼€å§‹è®­ç»ƒ
lerobot-train \
  --dataset.repo_id=jzzz/il_gym \
  --policy.type=act \
  --output_dir=outputs/train/il_gym \
  --job_name=il_gym \
  --policy.device=cuda \
  --steps=5000 \
  --save_checkpoint=true \
  --save_freq=1000 \
  --wandb.enable=false \
  --policy.push_to_hub=false
```

**è®­ç»ƒå‚æ•°è¯´æ˜ï¼š**
- `--dataset.repo_id=jzzz/il_gym`ï¼šä½¿ç”¨æ‚¨é‡‡é›†çš„æ•°æ®é›†
- `--policy.type=act`ï¼šä½¿ç”¨ACTï¼ˆAction Chunking with Transformersï¼‰ç®—æ³•
- `--output_dir=outputs/train/il_gym`ï¼šå­˜æ”¾è®­ç»ƒå¥½çš„æ¨¡å‹çš„åœ°å€
- `--steps`ï¼šæ€»è®­ç»ƒæ­¥æ•°
- `--save_freq=1000`ï¼šå¤šå°‘æ­¥ä¿å­˜ä¸€ä¸ªæ£€æŸ¥ç‚¹
- `--policy.push_to_hub=false`ï¼šä¸è‡ªåŠ¨ä¸Šä¼ è‡³huggingfaceä»“åº“ï¼Œä¿å­˜åœ¨æœ¬åœ°

**è®­ç»ƒè¿‡ç¨‹ï¼š**
- è®­ç»ƒä¼šè‡ªåŠ¨ä¿å­˜checkpointåˆ° `outputs/train/il_gym/checkpoints/`
- æ¨èè®­ç»ƒè‡³å°‘5000æ­¥
- è®­ç»ƒå®Œæˆåä¼šç”Ÿæˆ `pretrained_model` æ–‡ä»¶å¤¹

### ç¬¬ä¸‰é˜¶æ®µï¼šç­–ç•¥æ¨ç†

#### 1. åˆ›å»ºæ¨ç†é…ç½®
åˆ›å»ºæ–‡ä»¶ `eval_config_minimal.json`ï¼š

```json
{
  "env": {
    "type": "gym_manipulator",
    "name": "gym_hil",
    "task": "PandaPickCubeKeyboard-v0",
    "fps": 8,
    "robot": null,
    "teleop": null,
    "processor": {
      "control_mode": "keyboard",
      "observation": {
        "add_joint_velocity_to_observation": true,
        "add_current_to_observation": true,
        "display_cameras": false
      },
      "image_preprocessing": {
        "crop_params_dict": {
          "observation.images.front": [0, 0, 128, 128],
          "observation.images.wrist": [0, 0, 128, 128]
        },
        "resize_size": [128, 128]
      },
      "gripper": {
        "use_gripper": true,
        "gripper_penalty": 0
      },
      "reset": {
        "fixed_reset_joint_positions": [0.0, 0.195, 0.0, -2.43, 0.0, 2.62, 0.785],
        "reset_time_s": 2.0,
        "control_time_s": 20.0,
        "terminate_on_success": true
      },
      "reward_classifier": {
        "pretrained_path": null
      }
    }
  },
  "dataset": {
    "repo_id": "jzzz/il_gym",
    "use_imagenet_stats": false
  },
  "policy": {
    "type": "act",
    "device": "cuda",
    "n_obs_steps": 1,
    "normalization_mapping": {
      "VISUAL": "MEAN_STD",
      "STATE": "MEAN_STD",
      "ACTION": "MEAN_STD"
    },
    "input_features": {
      "agent_pos": {
        "type": "STATE",
        "shape": [18]
      },
      "pixels.front": {
        "type": "VISUAL",
        "shape": [3, 128, 128]
      },
      "pixels.wrist": {
        "type": "VISUAL",
        "shape": [3, 128, 128]
      }
    },
    "output_features": {
      "action": {
        "type": "ACTION",
        "shape": [4]
      }
    },
    "chunk_size": 100,
    "n_action_steps": 100,
    "vision_backbone": "resnet18",
    "pretrained_backbone_weights": "ResNet18_Weights.IMAGENET1K_V1",
    "replace_final_stride_with_dilation": false,
    "pre_norm": false,
    "dim_model": 512,
    "n_heads": 8,
    "dim_feedforward": 3200,
    "feedforward_activation": "relu",
    "n_encoder_layers": 4,
    "n_decoder_layers": 1,
    "use_vae": true,
    "latent_dim": 32,
    "n_vae_encoder_layers": 4,
    "temporal_ensemble_coeff": null,
    "dropout": 0.1,
    "kl_weight": 10.0,
    "optimizer_lr": 1e-05,
    "optimizer_weight_decay": 0.0001,
    "optimizer_lr_backbone": 1e-05,
    "use_amp": false
  }
}
```

#### 2. è¿è¡Œç­–ç•¥æ¨ç†
```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate lerobot_v3

# è¿è¡Œæ¨ç†
python -m lerobot.rl.eval_policy --config_path=eval_config_minimal.json --policy.path="/home/jzzz/dora_ws/lerobot_v3/outputs/train/il_gym/checkpoints/005000/pretrained_model"
```

**æ³¨æ„ï¼š** è¯·å°†è·¯å¾„ä¸­çš„ `005000` æ›¿æ¢ä¸ºæ‚¨å®é™…è®­ç»ƒçš„checkpointæ­¥æ•°ã€‚

## é«˜çº§é…ç½®é€‰é¡¹

### æ•°æ®é‡‡é›†å‚æ•°è°ƒä¼˜

#### å›¾åƒé¢„å¤„ç†å‚æ•°
```json
"image_preprocessing": {
  "crop_params_dict": {
    "observation.images.front": [x, y, width, height],
    "observation.images.wrist": [x, y, width, height]
  },
  "resize_size": [width, height]
}
```

#### æ§åˆ¶å‚æ•°
```json
"processor": {
  "control_mode": "keyboard",  // æˆ– "gamepad"
  "observation": {
    "add_joint_velocity_to_observation": true,  // æ·»åŠ å…³èŠ‚é€Ÿåº¦
    "add_current_to_observation": true,        // æ·»åŠ ç”µæµä¿¡æ¯
    "display_cameras": false                   // æ˜¯å¦æ˜¾ç¤ºç›¸æœºç”»é¢
  }
}
```

### è®­ç»ƒå‚æ•°è°ƒä¼˜

#### ACTç­–ç•¥å‚æ•°
```bash
# åŸºç¡€è®­ç»ƒå‘½ä»¤
lerobot-train --dataset.repo_id=jzzz/il_gym --policy.type=act

# é«˜çº§å‚æ•°ç¤ºä¾‹
lerobot-train \
  --dataset.repo_id=jzzz/il_gym \
  --policy.type=act \
  --policy.chunk_size=50 \
  --policy.n_action_steps=50 \
  --policy.dim_model=256 \
  --policy.n_heads=4 \
  --policy.n_encoder_layers=2 \
  --policy.dropout=0.1 \
  --policy.optimizer_lr=1e-4 \
  --policy.use_vae=true \
  --policy.latent_dim=16
```

#### è®­ç»ƒç›‘æ§
```bash
# ä½¿ç”¨Weights & Biasesç›‘æ§è®­ç»ƒ
wandb login
lerobot-train --dataset.repo_id=jzzz/il_gym --policy.type=act --wandb.project=my_robot_project
```

### æ¨ç†å‚æ•°è°ƒä¼˜

#### è®¾å¤‡é€‰æ‹©
```json
"policy": {
  "device": "cuda",    // ä½¿ç”¨GPU
  // "device": "cpu",  // ä½¿ç”¨CPUï¼ˆè¾ƒæ…¢ï¼‰
}
```

#### è§‚å¯Ÿæ­¥æ•°è°ƒæ•´
```json
"policy": {
  "n_obs_steps": 1,    // ä½¿ç”¨1æ­¥å†å²
  // "n_obs_steps": 3, // ä½¿ç”¨3æ­¥å†å²ï¼ˆéœ€è¦æ›´å¤šå†…å­˜ï¼‰
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. CUDAå†…å­˜ä¸è¶³
```bash
# å‡å°‘batch sizeæˆ–ä½¿ç”¨CPU
"policy": {
  "device": "cpu"
}
```

#### 2. æ•°æ®é›†åŠ è½½å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®é›†æ˜¯å¦å­˜åœ¨
python -c "from lerobot.datasets.lerobot_dataset import LeRobotDataset; ds = LeRobotDataset('jzzz/il_gym'); print(ds.meta)"
```

#### 3. æ¨¡å‹åŠ è½½å¤±è´¥
```bash
# æ£€æŸ¥checkpointè·¯å¾„
ls -la outputs/train/il_gym/checkpoints/
```

#### 4. ç¯å¢ƒå¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥MuJoCoå®‰è£…
python -c "import mujoco; print('MuJoCo installed successfully')"
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. æ•°æ®é‡‡é›†ä¼˜åŒ–
- ä½¿ç”¨SSDå­˜å‚¨æ•°æ®é›†
- ç¡®ä¿å……è¶³çš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘10GBï¼‰
- é‡‡é›†æ—¶å…³é—­ä¸å¿…è¦çš„ç¨‹åº

#### 2. è®­ç»ƒä¼˜åŒ–
- ä½¿ç”¨GPUè¿›è¡Œè®­ç»ƒ
- è°ƒæ•´batch sizeä»¥å……åˆ†åˆ©ç”¨GPUå†…å­˜
- ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒï¼ˆ`use_amp: true`ï¼‰

#### 3. æ¨ç†ä¼˜åŒ–
- ä½¿ç”¨GPUè¿›è¡Œæ¨ç†
- å‡å°‘ä¸å¿…è¦çš„è§‚å¯Ÿå†å²
- ä¼˜åŒ–å›¾åƒé¢„å¤„ç†å‚æ•°

## è¯„ä¼°æŒ‡æ ‡

### ä»»åŠ¡æˆåŠŸç‡
- æˆåŠŸæŠ“å–å¹¶æ”¾ç½®ç‰©ä½“
- ä»»åŠ¡å®Œæˆæ—¶é—´
- åŠ¨ä½œæµç•…åº¦

### æ¨¡å‹æ€§èƒ½
- è®­ç»ƒæŸå¤±æ”¶æ•›æƒ…å†µ
- éªŒè¯é›†æ€§èƒ½
- æ¨ç†é€Ÿåº¦

## æäº¤è¦æ±‚

### å¿…éœ€æ–‡ä»¶
1. è®­ç»ƒå¥½çš„æ¨¡å‹checkpoint
2. æ•°æ®é›†é…ç½®æ–‡ä»¶
3. æ¨ç†é…ç½®æ–‡ä»¶
4. è®­ç»ƒæ—¥å¿—

### è¯„ä¼°æ ‡å‡†
1. **ä»»åŠ¡å®Œæˆç‡**ï¼šæˆåŠŸå®ŒæˆæŠ“å–ä»»åŠ¡çš„æ¯”ä¾‹
2. **æ•ˆç‡**ï¼šå®Œæˆä»»åŠ¡æ‰€éœ€çš„æ—¶é—´
3. **ç¨³å®šæ€§**ï¼šå¤šæ¬¡è¿è¡Œçš„ä¸€è‡´æ€§
4. **åˆ›æ–°æ€§**ï¼šç®—æ³•æ”¹è¿›æˆ–å‚æ•°è°ƒä¼˜

## æŠ€æœ¯æ”¯æŒ

### å®˜æ–¹èµ„æº
- [LeRobot GitHub](https://github.com/huggingface/lerobot)
- [LeRobot HuggingFace](https://huggingface.co/lerobot)
- [Discordç¤¾åŒº](https://discord.gg/s3KuuzsPFb)

### å¸¸è§é—®é¢˜
1. **Q: å¦‚ä½•å¢åŠ è®­ç»ƒæ•°æ®ï¼Ÿ**
   A: é‡‡é›†æ›´å¤šepisodeï¼Œå»ºè®®è‡³å°‘10ä¸ªepisode

2. **Q: å¦‚ä½•æé«˜æˆåŠŸç‡ï¼Ÿ**
   A: ä¼˜åŒ–æ•°æ®è´¨é‡ï¼Œè°ƒæ•´è®­ç»ƒå‚æ•°ï¼Œå¢åŠ è®­ç»ƒæ­¥æ•°

3. **Q: å¦‚ä½•åŠ é€Ÿè®­ç»ƒï¼Ÿ**
   A: ä½¿ç”¨GPUï¼Œè°ƒæ•´batch sizeï¼Œä½¿ç”¨æ··åˆç²¾åº¦

4. **Q: å¦‚ä½•å¤„ç†ä¸åŒä»»åŠ¡ï¼Ÿ**
   A: ä¿®æ”¹ç¯å¢ƒé…ç½®ä¸­çš„taskå‚æ•°ï¼Œé‡æ–°é‡‡é›†æ•°æ®

## æ€»ç»“

æœ¬æŒ‡å—æä¾›äº†å®Œæ•´çš„æœºå™¨äººæ¨¡ä»¿å­¦ä¹ æµç¨‹ï¼Œä»æ•°æ®é‡‡é›†åˆ°æ¨¡å‹è®­ç»ƒå†åˆ°ç­–ç•¥æ¨ç†ã€‚é€šè¿‡éµå¾ªè¿™äº›æ­¥éª¤ï¼Œæ‚¨å¯ä»¥æˆåŠŸè®­ç»ƒå‡ºèƒ½å¤Ÿæ‰§è¡ŒæŠ“å–ä»»åŠ¡çš„æœºå™¨äººç­–ç•¥ã€‚

è®°ä½ï¼š
- æ•°æ®è´¨é‡å†³å®šæ¨¡å‹æ€§èƒ½
- å……åˆ†çš„è®­ç»ƒæ—¶é—´å¾ˆé‡è¦
- å‚æ•°è°ƒä¼˜éœ€è¦è€å¿ƒå’Œå®éªŒ
- è¯„ä¼°å’Œè¿­ä»£æ˜¯æ”¹è¿›çš„å…³é”®

ç¥æ‚¨åœ¨æ¯”èµ›ä¸­å–å¾—å¥½æˆç»©ï¼ğŸ¯
